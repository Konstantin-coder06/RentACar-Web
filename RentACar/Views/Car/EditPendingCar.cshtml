@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@model EditCarWithImagesPendingViewModel

@{
    ViewData["HideNavigation"] = true;
    ViewData["HideFooter"] = true;
    if (User.IsInRole("Company"))
    {
        ViewData["Title"] = "Edit Your Car";
    }
    else if(User.IsInRole("Admin")){
        ViewData["Title"] = "Approave Car";
    }
}
<link rel="stylesheet" href="~/css/editCar.css" asp-append-version="true" />
@if (!ViewData.ModelState.IsValid)
{
    <div class="alert alert-danger">
        <ul>
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <li>@error.ErrorMessage</li>
            }
        </ul>
    </div>
}
<div class="container mt-5">
    <h2>Edit Car</h2>
    <hr />

    <form asp-action="EditPendingCar" asp-controller="Car"  enctype="multipart/form-data">

        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

        <div class="row">

            <div class="col-md-6">
                <fieldset>
                    <legend>Basic Information</legend>
                    <div class="form-group">
                        <label asp-for="Brand" class="control-label"></label>
                        <input asp-for="Brand" class="form-control" />
                        <span asp-validation-for="Brand" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="Model" class="control-label"></label>
                        <input asp-for="Model" class="form-control" />
                        <span asp-validation-for="Model" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="ClassOptions" class="control-label">Vehicle Class</label>
                        <select asp-for="ClassOfCarId" asp-items="Model.ClassOptions" class="form-control">
                            <option value="">-- Select Class --</option>
                        </select>
                        <span asp-validation-for="ClassOfCarId" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                        <label asp-for="TypeOptions" class="control-label">Vehicle Type</label>
                        <select asp-for="TypeId" asp-items="Model.TypeOptions" class="form-control">
                            <option value="">-- Select Type--</option>
                        </select>
                        <span asp-validation-for="TypeId" class="text-danger"></span>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>Is The Car Convertible?</legend>
                    <div class="form-group mb-3">
                        <div class="form-check">
                            <input type="radio" asp-for="IsConvertible" value="true" class="form-check-input" id="convertibleYes" />
                            <label class="form-check-label" for="convertibleYes">Yes, it is convertible</label>
                        </div>
                        <div class="form-check">
                            <input type="radio" asp-for="IsConvertible" value="false" class="form-check-input" id="convertibleNo" />
                            <label class="form-check-label" for="convertibleNo">No, it is not convertible</label>
                        </div>
                        <span asp-validation-for="IsConvertible" class="text-danger"></span>
                    </div>
                </fieldset>
            </div>


            <div class="row mt-3">
                <legend>Technical Specifications</legend>
                <div class="col-md-4">

                    <div class="form-group">
                        <label asp-for="EngineCapacity" class="control-label"></label>
                        <input asp-for="EngineCapacity" class="form-control" step="0.1" />
                        <span asp-validation-for="EngineCapacity" class="text-danger"></span>
                    </div>
                </div>
                <div class="col-md-4">

                    <div class="form-group">
                        <label asp-for="HorsePower" class="control-label"></label>
                        <input asp-for="HorsePower" class="form-control" />
                        <span asp-validation-for="HorsePower" class="text-danger"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label asp-for="TopSpeed" class="control-label"></label>
                    <input asp-for="TopSpeed" class="form-control" />
                    <span asp-validation-for="TopSpeed" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="ZeroToHundred" class="control-label"></label>
                    <input asp-for="ZeroToHundred" class="form-control" />
                    <span asp-validation-for="ZeroToHundred" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Color" class="control-label"></label>
                    <input asp-for="Color" class="form-control" />
                    <span asp-validation-for="Color" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="Description" class="control-label"></label>
                    <input asp-for="Description" class="form-control" />
                    <span asp-validation-for="Description" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="DriveTrain" class="control-label"></label>
                    <input asp-for="DriveTrain" class="form-control" />
                    <span asp-validation-for="DriveTrain" class="text-danger"></span>
                </div>

            </div>
        </div>


        <div class="row mt-3">

            <legend>Price</legend>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="PricePerDay" class="control-label"></label>
                    <input asp-for="PricePerDay" class="form-control" />
                    <span asp-validation-for="PricePerDay" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="PricePerWeek" class="control-label"></label>
                    <input asp-for="PricePerWeek" class="form-control" />
                    <span asp-validation-for="PricePerWeek" class="text-danger"></span>
                </div>
            </div>

        </div>
        <div class="row mt-3">
            <legend>Mileage</legend>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="MileageLimitForDay" class="control-label"></label>
                    <input asp-for="MileageLimitForDay" class="form-control" />
                    <span asp-validation-for="MileageLimitForDay" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="MileageLimitForWeek" class="control-label"></label>
                    <input asp-for="MileageLimitForWeek" class="form-control" />
                    <span asp-validation-for="MileageLimitForWeek" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="AdditionalMileageCharge" class="control-label"></label>
                    <input asp-for="AdditionalMileageCharge" class="form-control" />
                    <span asp-validation-for="AdditionalMileageCharge" class="text-danger"></span>
                </div>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="Gearbox" class="control-label"></label>
                    <input asp-for="Gearbox" class="form-control" />
                    <span asp-validation-for="Gearbox" class="text-danger"></span>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label asp-for="Year" class="control-label"></label>
                    <input asp-for="Year" class="form-control" />
                    <span asp-validation-for="Year" class="text-danger"></span>
                </div>
            </div>
        </div>
        <fieldset class="mt-4 w-100">
            <legend>Features</legend>
            <div class="row">
                <div class="col-12">
                    <div class="form-group mb-3">
                        @if (Model.Features != null && Model.Features.Any())
                        {
                            <div class="row">
                                @foreach (var feature in Model.Features.OrderBy(x => x))
                                {
                                    <div class="col-md-3 col-sm-6 mb-2">
                                        <div class="form-check">
                                            <input type="checkbox" name="SelectedFeatures" value="@feature"
                                            class="form-check-input"
                                            @(Model.SelectedFeatures != null && Model.SelectedFeatures.Contains(feature) ? "checked" : "") />
                                            <label class="form-check-label" for="feature-@feature">@feature</label>
                                        </div>
                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <p>No features available.</p>
                        }
                    </div>
                </div>
            </div>
        </fieldset>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


        <div class="form-group mt-4">
            <label asp-for="Images" class="control-label">Uploaded Images</label>


            <div id="imagePreviewContainer" class="d-flex flex-wrap mt-2 border p-2" style="min-height: 100px;">
                @if (Model.Images != null && Model.Images.Any())
                {
                    foreach (var image in Model.Images.OrderBy(x => x.Order))
                    {
                        <div class="image-preview-item position-relative m-2" data-id="@image.Id">
                            <img src="@image.Url" alt="Car Image" class="existing-image" width="120" height="80" style="object-fit:cover; border-radius: 5px;">
                        </div>
                    }
                }
            </div>


            <input type="hidden" id="imageOrder" name="imageOrder">


            <button type="button" id="saveOrderButton" class="btn btn-primary mt-3">Save Order</button>
        </div>



        <div class="form-group mt-4">
            @if (User.IsInRole("Company"))
            {
                @if ((bool)TempData["IsPending"])
                {
                    <button type="submit" class="btn btn-primary">Edit Your Car</button>
                }
                else
                {
                    <button type="submit" class="btn btn-primary" onclick="return confirm('If You Edit It, The Car Will Wait Approaval For Showing It Back! Are you sure you want to edit this car?');">Edit Your Car</button>
                }
            }else{
                <button type="submit" class="btn btn-primary">Approave Car</button>
            }
            <a asp-action="Index" class="btn btn-secondary me-2">Cancel</a>
        </div>
    </form>


    <form asp-controller="Car" asp-action="DeleteCar" asp-route-id="@Model.Id" class="mt-3">
        <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this car?');">Delete Car</button>
    </form>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script src="~/js/editImageOrder.js"></script>      
      



@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $('.custom-file-input').on('change', function() {
            var files = $(this)[0].files;
            var label = files.length > 1 ?
                files.length + ' files selected' :
                files[0].name;
            $(this).next('.custom-file-label').html(label);
        });
    </script>
}
